# Docker Wordpress - Starter

**Docker-Compose** file to spin a development environment for Wordpress.

## Stack - Docker hub images
- [Wordpress:latest](https://github.com/docker-library/wordpress/blob/394c79eafd5b345514f87cec590577e641c030ef/latest/php7.4/apache/Dockerfile)
  - php7.4
  - Apache
- [MySql 5.7](https://github.com/docker-library/mysql/blob/b11f06b0d202e7b0f97b000e158fc4fc869d2194/5.7/Dockerfile.debian)
- [PHPMyAdmin:latest](https://github.com/phpmyadmin/docker/blob/3d8c2ba403fa091a19c6f16762d50663e57f8969/apache/Dockerfile)

## Usage
- Copy the `docker-compose.yml` file inside the current working/project directory

- Change environment variables for each service

### Persisting data generated by and used by Docker containers

How to handle persistency is arbitrary and may change by project.

### SHORT SYNTAX
```yml
volumes:
  # Just specify a path and let the Engine create a volume
  - /var/lib/mysql

  # Specify an absolute path mapping
  - /opt/data:/var/lib/mysql

  # Path on the host, relative to the Compose file
  - ./cache:/tmp/cache

  # User-relative path
  - ~/configs:/etc/configs/:ro

  # Named volume
  - datavolume:/var/lib/mysql

```
If we already have generated volumes we can use/attach them as external volumes, like this:

```yml
volumes:
  wp_html:
    external: true
    name: docker-wordpress-starter_wordpress
  db_data:
    external: true
    name: docker-wordpress-starter_db_data
```
or if we want to generate **docker compose** allows us to do so :
```yml
volumes:
  wp_html:
  db_data: {}
```
- run `docker-compose up -d`

## Next (future improvements)
- ~~Add PHPMyAdmin~~
- Wordpress Database volume backup and Restore
- Wordpress files volume backup and Restore
- Editable configs files (`.htaccess` apache `httpd.conf`, etc...)
- Add SSL certificates for local dev

## Known Issues
### #1. Wordpress site Health reports REST API issues (curl and loopback error)
> SOLVED

1. Stop the containers
2. In `docker-compose.yml` change ports from "8000:80"  to "80:80"
3. Remove db volume - this will remove all db data!!
    - `docker volume ls` - find volume name
    - `docker volume rm <name>`

4. Start the containers and go to http://localhost/

### 2. MySql doesn't allow to upload packets bigger than 4MB
This was causing an issue with the wpvivid-backup plugin preventing me to upload backups.
> SOLVED - In Docker Compose we can pass commands to the mysql service-container we are building:
```yml
...
services:
  db:
    image: mysql:5.7
    command: --max_allowed_packet=32505856 // <--cool
    volumes:
      - db_data:/var/lib/mysql
    restart: always
    environment:
...
```
## Resources
[Docker Docs](https://docs.docker.com/)

[Volumes in Docker](https://docs.docker.com/storage/volumes/)

[Volumes with Docker-Compose](https://docs.docker.com/compose/compose-file/compose-file-v3/#volume-configuration-reference)